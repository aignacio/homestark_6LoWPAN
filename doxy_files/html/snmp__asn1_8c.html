<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>HomeStark_6LoWPAN_Device: Referência ao ficheiro snmpd/snmp_asn1.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_symbol.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">HomeStark_6LoWPAN_Device
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Código fonte do dispositivo 6LoWPAN da rede HomeStark</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Gerado por Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Localizar');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Página&#160;principal</span></a></li>
      <li><a href="pages.html"><span>Páginas&#160;relacionadas</span></a></li>
      <li><a href="modules.html"><span>Módulos</span></a></li>
      <li><a href="annotated.html"><span>Estruturas&#160;de&#160;dados</span></a></li>
      <li class="current"><a href="files.html"><span>Ficheiros</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Localizar" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>Lista&#160;de&#160;ficheiros</span></a></li>
      <li><a href="globals.html"><span>Globais</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>Tudo</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Estruturas de dados</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Ficheiros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Funções</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variáveis</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerações</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Valores da enumeração</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Grupos</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Páginas</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bc83ca815ba75edffbc2ec0c3eb5f066.html">snmpd</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Funções</a>  </div>
  <div class="headertitle">
<div class="title">Referência ao ficheiro snmp_asn1.c</div>  </div>
</div><!--header-->
<div class="contents">

<p>Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements.  
<a href="#details">Mais...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &quot;<a class="el" href="snmp_8h_source.html">snmp.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="mibii_8h_source.html">mibii.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Diagrama de dependências de inclusão para snmp_asn1.c:</div>
<div class="dyncontent">
<div class="center"><img src="snmp__asn1_8c__incl.png" border="0" usemap="#snmpd_2snmp__asn1_8c" alt=""/></div>
<map name="snmpd_2snmp__asn1_8c" id="snmpd_2snmp__asn1_8c">
<area shape="rect" id="node6" href="snmp_8h.html" title="Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements..." alt="" coords="625,80,690,107"/><area shape="rect" id="node16" href="mibii_8h.html" title="Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements..." alt="" coords="74,80,134,107"/><area shape="rect" id="node15" href="homestark_8h.html" title="Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements..." alt="" coords="1106,155,1201,181"/></map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Funções</h2></td></tr>
<tr class="memitem:a7a9e77260c38b403e735d841d860d643"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7a9e77260c38b403e735d841d860d643"></a>
<a class="el" href="snmp_8h.html#add91ba4199db8665b9b9fc56fc6783a6">resp_con_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>error_check_snmp</b> (uint8_t *error_data)</td></tr>
<tr class="separator:a7a9e77260c38b403e735d841d860d643"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c7f91118bbe8cf32398c753ead2b7f2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="snmp_8h.html#add91ba4199db8665b9b9fc56fc6783a6">resp_con_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="snmp__asn1_8c.html#a0c7f91118bbe8cf32398c753ead2b7f2">decode_asn1_oct_str</a> (uint8_t *data_encoded, uint8_t *oct_str)</td></tr>
<tr class="memdesc:a0c7f91118bbe8cf32398c753ead2b7f2"><td class="mdescLeft">&#160;</td><td class="mdescRight">SNMP Decode Octet String.  <a href="#a0c7f91118bbe8cf32398c753ead2b7f2">Mais...</a><br /></td></tr>
<tr class="separator:a0c7f91118bbe8cf32398c753ead2b7f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb3a9652e9b960748692caef7f443384"><td class="memItemLeft" align="right" valign="top"><a class="el" href="snmp_8h.html#add91ba4199db8665b9b9fc56fc6783a6">resp_con_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="snmp__asn1_8c.html#acb3a9652e9b960748692caef7f443384">decode_asn1_integer</a> (uint8_t *data_encoded, uint32_t *integer_value)</td></tr>
<tr class="memdesc:acb3a9652e9b960748692caef7f443384"><td class="mdescLeft">&#160;</td><td class="mdescRight">SNMP Decode Integer.  <a href="#acb3a9652e9b960748692caef7f443384">Mais...</a><br /></td></tr>
<tr class="separator:acb3a9652e9b960748692caef7f443384"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8347162889dff52c2fb4487d9a83ab3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="snmp_8h.html#add91ba4199db8665b9b9fc56fc6783a6">resp_con_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="snmp__asn1_8c.html#af8347162889dff52c2fb4487d9a83ab3">snmp_decode_message</a> (char *snmp_packet, <a class="el" href="structsnmp__t.html">snmp_t</a> *snmp_handle)</td></tr>
<tr class="memdesc:af8347162889dff52c2fb4487d9a83ab3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Decode SNMP message.  <a href="#af8347162889dff52c2fb4487d9a83ab3">Mais...</a><br /></td></tr>
<tr class="separator:af8347162889dff52c2fb4487d9a83ab3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63d8ffecf9aa0af9824de046643c140f"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="snmp__asn1_8c.html#a63d8ffecf9aa0af9824de046643c140f">snmp_encode_message</a> (<a class="el" href="structsnmp__t.html">snmp_t</a> *snmp_handle, char *data_encoded)</td></tr>
<tr class="memdesc:a63d8ffecf9aa0af9824de046643c140f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Encode SNMP message.  <a href="#a63d8ffecf9aa0af9824de046643c140f">Mais...</a><br /></td></tr>
<tr class="separator:a63d8ffecf9aa0af9824de046643c140f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af72c0873252d8160ff31eae19d05a5a1"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="snmp__asn1_8c.html#af72c0873252d8160ff31eae19d05a5a1">snmp_encode_trap</a> (uint8_t *trap_pdu, uint8_t type_trap, uint8_t heartbeat)</td></tr>
<tr class="memdesc:af72c0873252d8160ff31eae19d05a5a1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Encode a SNMPv1 Trap message.  <a href="#af72c0873252d8160ff31eae19d05a5a1">Mais...</a><br /></td></tr>
<tr class="separator:af72c0873252d8160ff31eae19d05a5a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Descrição detalhada</h2>
<div class="textblock"><p>Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. </p>
<p>See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at</p>
<p><a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>
<p>This project is under APACHE 2.0 license.</p>
<p>Encoding and decoding functions to SNMP agent </p><dl class="section author"><dt>Autor</dt><dd>Ânderson Ignácio da Silva </dd></dl>
<dl class="section date"><dt>Data</dt><dd>19 Sept 2016 </dd></dl>
<dl class="section see"><dt>Veja também</dt><dd><a href="http://www.aignacio.com">http://www.aignacio.com</a> </dd></dl>
</div><h2 class="groupheader">Documentação das funções</h2>
<a class="anchor" id="acb3a9652e9b960748692caef7f443384"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="snmp_8h.html#add91ba4199db8665b9b9fc56fc6783a6">resp_con_t</a> decode_asn1_integer </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>data_encoded</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>integer_value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>SNMP Decode Integer. </p>
<p>Decode ASN.1 integer(32 bit value).</p>
<dl class="params"><dt>Parâmetros</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">data_encoded</td><td>Data do decode </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">integer_value</td><td>Variable the will receive the integer 32-bit</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Valores retornados</dt><dd>
  <table class="retval">
    <tr><td class="paramname">SUCCESS_CON</td><td>Success to decode integer </td></tr>
    <tr><td class="paramname">FAIL_CON</td><td>Fail to decode integer </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                                                                              {</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  uint8_t length = (intptr_t)*(data_encoded+1);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="comment">// uint32_t integer_value;</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="keywordtype">size_t</span> i = 0;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  uint32_t aux;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="comment">// Test if it&#39;s an integer value to be decoded</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keywordflow">if</span> (*data_encoded != <a class="code" href="snmp_8h.html#a45fec4a033960bca8c60e2f40d1d0e04">ASN1_PRIM_INTEGER</a>){</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    debug_snmp(<span class="stringliteral">&quot;The value is not integer!&quot;</span>);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="snmp_8h.html#add91ba4199db8665b9b9fc56fc6783a6ac6ae922662cbaf7958eb387bfd6fe4da">FAIL_CON</a>;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  }</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="keywordflow">for</span> (i=1, *integer_value = 0; i &lt;= length; i++){</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    aux = *(data_encoded+1+i);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    *integer_value += aux*(pow(256,(length-i)));</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="comment">// debug_snmp(&quot;%lu * 256^%d = %lu&quot;,aux,(length-i),*integer_value);</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  }</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="snmp_8h.html#add91ba4199db8665b9b9fc56fc6783a6ae7b7a388c90c2c5428cced225760885f">SUCCESS_CON</a>;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;}</div>
<div class="ttc" id="snmp_8h_html_a45fec4a033960bca8c60e2f40d1d0e04"><div class="ttname"><a href="snmp_8h.html#a45fec4a033960bca8c60e2f40d1d0e04">ASN1_PRIM_INTEGER</a></div><div class="ttdeci">#define ASN1_PRIM_INTEGER</div><div class="ttdoc">Primitives data types of ANS.1 encoding. </div><div class="ttdef"><b>Definition:</b> snmp.h:59</div></div>
<div class="ttc" id="snmp_8h_html_add91ba4199db8665b9b9fc56fc6783a6ac6ae922662cbaf7958eb387bfd6fe4da"><div class="ttname"><a href="snmp_8h.html#add91ba4199db8665b9b9fc56fc6783a6ac6ae922662cbaf7958eb387bfd6fe4da">FAIL_CON</a></div><div class="ttdoc">Error to to process function. </div><div class="ttdef"><b>Definition:</b> snmp.h:143</div></div>
<div class="ttc" id="snmp_8h_html_add91ba4199db8665b9b9fc56fc6783a6ae7b7a388c90c2c5428cced225760885f"><div class="ttname"><a href="snmp_8h.html#add91ba4199db8665b9b9fc56fc6783a6ae7b7a388c90c2c5428cced225760885f">SUCCESS_CON</a></div><div class="ttdoc">Sucess to process function. </div><div class="ttdef"><b>Definition:</b> snmp.h:144</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0c7f91118bbe8cf32398c753ead2b7f2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="snmp_8h.html#add91ba4199db8665b9b9fc56fc6783a6">resp_con_t</a> decode_asn1_oct_str </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>data_encoded</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>oct_str</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>SNMP Decode Octet String. </p>
<p>Decode Octet String in ASN.1 format.</p>
<dl class="params"><dt>Parâmetros</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">data_encoded</td><td>Data do decode </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">oct_str</td><td>Variable the will receive the octet string</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Valores retornados</dt><dd>
  <table class="retval">
    <tr><td class="paramname">SUCCESS_CON</td><td>Success to decode string octet </td></tr>
    <tr><td class="paramname">FAIL_CON</td><td>Fail to decode octet string </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                                                                       {</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="keywordflow">if</span> (*data_encoded !=  (intptr_t)ASN1_PRIM_OCT_STR) {</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    debug_snmp(<span class="stringliteral">&quot;The type of value passed is not an octet string!&quot;</span>);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="snmp_8h.html#add91ba4199db8665b9b9fc56fc6783a6ac6ae922662cbaf7958eb387bfd6fe4da">FAIL_CON</a>;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  }</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  uint8_t length = (intptr_t)*(data_encoded+1),</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;          index = 0;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="keywordflow">while</span> (length) {</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    *(oct_str+index) = (intptr_t)*(data_encoded+2+index);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    length--;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    index++;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  }</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  *(oct_str+index) = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="comment">// printf(&quot;\nEndereco----:&gt; %d\n&quot;,oct_str);</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="snmp_8h.html#add91ba4199db8665b9b9fc56fc6783a6ae7b7a388c90c2c5428cced225760885f">SUCCESS_CON</a>;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;}</div>
<div class="ttc" id="snmp_8h_html_add91ba4199db8665b9b9fc56fc6783a6ac6ae922662cbaf7958eb387bfd6fe4da"><div class="ttname"><a href="snmp_8h.html#add91ba4199db8665b9b9fc56fc6783a6ac6ae922662cbaf7958eb387bfd6fe4da">FAIL_CON</a></div><div class="ttdoc">Error to to process function. </div><div class="ttdef"><b>Definition:</b> snmp.h:143</div></div>
<div class="ttc" id="snmp_8h_html_add91ba4199db8665b9b9fc56fc6783a6ae7b7a388c90c2c5428cced225760885f"><div class="ttname"><a href="snmp_8h.html#add91ba4199db8665b9b9fc56fc6783a6ae7b7a388c90c2c5428cced225760885f">SUCCESS_CON</a></div><div class="ttdoc">Sucess to process function. </div><div class="ttdef"><b>Definition:</b> snmp.h:144</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af8347162889dff52c2fb4487d9a83ab3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="snmp_8h.html#add91ba4199db8665b9b9fc56fc6783a6">resp_con_t</a> snmp_decode_message </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>snmp_packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsnmp__t.html">snmp_t</a> *&#160;</td>
          <td class="paramname"><em>v</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Decode SNMP message. </p>
<p>Decode a SNMP message v1 and format to answer request.</p>
<dl class="params"><dt>Parâmetros</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">snmp_packet</td><td>Data UDP - SNMP to decode </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">snmp_handle</td><td>Struct that will receive the SNMP request messsage</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Valores retornados</dt><dd>
  <table class="retval">
    <tr><td class="paramname">SUCCESS_CON</td><td>Success to decode SNMP Message </td></tr>
    <tr><td class="paramname">FAIL_CON</td><td>Fail to decode SNMP Message </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                                                                      {</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  uint8_t buffer[50], aux;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="keywordtype">size_t</span> i;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="preprocessor">  #ifdef DEBUG_SNMP_DECODING</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="comment">// debug_snmp(&quot;Encoded SNMP packet:\n\t&quot;);</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="comment">// for (i=0, j=0; i &lt; *(snmp_packet+1)+1; j++, i++){</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="comment">//   if (j &gt; 7){</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="comment">//     j = 0;</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="comment">//     printf(&quot;\n\t&quot;);</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="comment">//   }</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="comment">//   printf(&quot;[%02x] &quot;,*(snmp_packet+i));</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="comment">// }</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="snmp_8h.html#a388ebedb8b344492bded4ba233fab27d">check_seq</a>(*snmp_packet)){</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    debug_snmp(<span class="stringliteral">&quot;Sequence initial of SNMP message error:%x&quot;</span>,*snmp_packet);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="snmp_8h.html#add91ba4199db8665b9b9fc56fc6783a6ac6ae922662cbaf7958eb387bfd6fe4da">FAIL_CON</a>;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  }</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="comment">/************************ Check the SNMP version ****************************/</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="keywordflow">for</span> (i=0;i &lt; *(snmp_packet+3)+2; i++)</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    buffer[i] = *(snmp_packet+2+i);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  uint32_t SNMPv = 0;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="snmp__asn1_8c.html#acb3a9652e9b960748692caef7f443384">decode_asn1_integer</a>(buffer,&amp;SNMPv)) <span class="keywordflow">return</span> <a class="code" href="snmp_8h.html#add91ba4199db8665b9b9fc56fc6783a6ac6ae922662cbaf7958eb387bfd6fe4da">FAIL_CON</a>;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="preprocessor">  #ifdef DEBUG_SNMP_DECODING</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  debug_snmp(<span class="stringliteral">&quot;Version SNMP:[1] OK&quot;</span>);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="keywordflow">if</span> (SNMPv != <a class="code" href="snmp_8h.html#a1f1b7fadcf29f1de5bb406bf356c1d71">SNMP_VERSION_1</a>) {</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    debug_snmp(<span class="stringliteral">&quot;SNMP version is different from v1:%lu&quot;</span>,SNMPv);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="snmp_8h.html#add91ba4199db8665b9b9fc56fc6783a6ac6ae922662cbaf7958eb387bfd6fe4da">FAIL_CON</a>;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  }</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  snmp_handle-&gt;snmp_version = SNMPv;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="comment">/********************** Get the community string ****************************/</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <span class="keywordflow">for</span> (i=0;i &lt; *(snmp_packet+6)+2; i++)</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  snmp_handle-&gt;community[i] = *(snmp_packet+5+i);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  snmp_handle-&gt;community[i] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  aux = i;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="preprocessor">  #ifdef DEBUG_SNMP_DECODING</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  debug_snmp(<span class="stringliteral">&quot;Community String: &quot;</span>);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="keywordflow">for</span> (i=0; i &lt; aux; i++){</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordflow">if</span> (i&lt;2)</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      printf(<span class="stringliteral">&quot;[%d]&quot;</span>,snmp_handle-&gt;community[i]);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      printf(<span class="stringliteral">&quot;[%c]&quot;</span>,snmp_handle-&gt;community[i]);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="comment">/************************** Get the request ID ******************************/</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  aux = 5+snmp_handle-&gt;community[1]+2+2;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="keywordflow">for</span> (i=0;i &lt; *(snmp_packet+aux+1)+2; i++)</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    snmp_handle-&gt;request_id_c[i] = *(snmp_packet+aux+i);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  snmp_handle-&gt;request_id_c[i] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  aux = i;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="preprocessor">  #ifdef DEBUG_SNMP_DECODING</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  debug_snmp(<span class="stringliteral">&quot;Request ID: &quot;</span>);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keywordflow">for</span> (i=0; i &lt; aux; i++){</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordflow">if</span> (i&lt;2)</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      printf(<span class="stringliteral">&quot;[%d]&quot;</span>,snmp_handle-&gt;request_id_c[i]);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    printf(<span class="stringliteral">&quot;[%x]&quot;</span>,snmp_handle-&gt;request_id_c[i]);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  }</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="comment">/************************** Check for errors ********************************/</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  aux = 5+(snmp_handle-&gt;community[1]+2)+2+(snmp_handle-&gt;request_id_c[1]+2);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="keywordflow">for</span> (i=0;i &lt; 6; i++)</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    buffer[i] = *(snmp_packet+aux+i);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  buffer[i] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  error_check_snmp(buffer);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="comment">/**************************** Get the OID ***********************************/</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  aux = 5+(snmp_handle-&gt;community[1]+2);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  aux += 2+(snmp_handle-&gt;request_id_c[1]+2)+10;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="keywordflow">for</span> (i=0;i &lt; *(snmp_packet+aux+1)+2; i++)</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    snmp_handle-&gt;oid_encoded[i] = *(snmp_packet+aux+i);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  snmp_handle-&gt;oid_encoded[i] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  aux = i;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="preprocessor">  #ifdef DEBUG_SNMP_DECODING</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  debug_snmp(<span class="stringliteral">&quot;OID: &quot;</span>);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="keywordflow">for</span> (i=0; i &lt; aux; i++){</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordflow">if</span> (i &lt;= 1)</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      printf(<span class="stringliteral">&quot;[%d]&quot;</span>,snmp_handle-&gt;oid_encoded[i]);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == 2)</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      printf(<span class="stringliteral">&quot;[%d.&quot;</span>,snmp_handle-&gt;oid_encoded[i]);</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    printf(<span class="stringliteral">&quot;%d.&quot;</span>,snmp_handle-&gt;oid_encoded[i]);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  }</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  printf(<span class="stringliteral">&quot;]&quot;</span>);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="comment">/************************** Get the PDU type ********************************/</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  aux = 5+(snmp_handle-&gt;community[1]+2);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  snmp_handle-&gt;request_type  = *(snmp_packet+aux);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  snmp_handle-&gt;response_type = ASN1_CPX_GET_RESP;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  uint8_t string_value[<a class="code" href="snmp_8h.html#a23bdc4d15d908a80e4bc06be55463ffc">MAX_OCTET_STRING</a>];</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  uint8_t status_mib2 = <a class="code" href="mibii_8c.html#aa0bb802c0b80aaab6218e5a7753f8e28">mib_ii_get_oid</a>(snmp_handle-&gt;oid_encoded,&amp;string_value[0]);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <span class="keywordflow">switch</span> (snmp_handle-&gt;request_type) {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="snmp_8h.html#aa4d923102cb2314e31cbf833482e9090">ASN1_CPX_SEQUENCE</a>:</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordflow">case</span> ASN1_CPX_GET_REQ:</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      aux = snmp_handle-&gt;oid_encoded[1]+1;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      <span class="keywordflow">if</span> (snmp_handle-&gt;oid_encoded[aux] != 0   ||</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;          snmp_handle-&gt;oid_encoded[aux-3] != 1 ||</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;          snmp_handle-&gt;oid_encoded[aux-4] != 2 ||</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;          snmp_handle-&gt;oid_encoded[aux-5] != 1 ||</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;          snmp_handle-&gt;oid_encoded[aux-6] != 6 ||</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;          snmp_handle-&gt;oid_encoded[aux-7] != 0x2b){</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        snmp_handle-&gt;oid_encoded[aux] = 1;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        status_mib2 = <a class="code" href="mibii_8c.html#aa0bb802c0b80aaab6218e5a7753f8e28">mib_ii_get_oid</a>(snmp_handle-&gt;oid_encoded,&amp;string_value[0]);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      }</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="preprocessor">      #ifdef DEBUG_SNMP_DECODING</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      debug_snmp(<span class="stringliteral">&quot;GET Request PDU Type&quot;</span>);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="preprocessor">      #endif</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      <span class="keywordflow">if</span> (!status_mib2){</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="preprocessor">        #ifdef DEBUG_SNMP_DECODING</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        debug_snmp(<span class="stringliteral">&quot;There isn&#39;t an value for that OID!&quot;</span>);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="preprocessor">        #endif</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        snmp_handle-&gt;value[0] = 0x05;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        snmp_handle-&gt;value[1] = 0x00;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      }</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        aux = strlen((<span class="keyword">const</span> <span class="keywordtype">char</span>*)string_value);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        snmp_handle-&gt;value[0] = ASN1_PRIM_OCT_STR;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        snmp_handle-&gt;value[1] = aux;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; aux; i++)</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;          snmp_handle-&gt;value[2+i] = string_value[i];</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        #ifdef DEBUG_SNMP_DECODING</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        debug_snmp(<span class="stringliteral">&quot;String for OID: &quot;</span>);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <span class="keywordflow">for</span> (i=0; i &lt; aux+2; i++){</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;          <span class="keywordflow">if</span> (i == 0)</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            printf(<span class="stringliteral">&quot;[%x]&quot;</span>,snmp_handle-&gt;value[i]);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == 1)</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            printf(<span class="stringliteral">&quot;[%d][&quot;</span>,snmp_handle-&gt;value[i]);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            printf(<span class="stringliteral">&quot;%c&quot;</span>,snmp_handle-&gt;value[i]);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        }</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        printf(<span class="stringliteral">&quot;]&quot;</span>);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="preprocessor">        #endif</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">case</span> ASN1_CPX_NEXT_REQ:</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      <span class="comment">// Let&#39;s check the last byte</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      aux = snmp_handle-&gt;oid_encoded[1]+1;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      <span class="keywordflow">if</span> (snmp_handle-&gt;oid_encoded[aux] == 0) {</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="comment">// We need to increment the OID for the snmpwalk... requisition</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keywordflow">if</span> (snmp_handle-&gt;oid_encoded[aux-1] &lt; 9) {</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;          snmp_handle-&gt;oid_encoded[aux-1] = snmp_handle-&gt;oid_encoded[aux-1]+1;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        }</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;          snmp_handle-&gt;oid_encoded[aux] = 1; <span class="comment">// Let&#39;s force not unknow value in the mib tree</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        status_mib2 = <a class="code" href="mibii_8c.html#aa0bb802c0b80aaab6218e5a7753f8e28">mib_ii_get_oid</a>(snmp_handle-&gt;oid_encoded,&amp;string_value[0]);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      }</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <span class="keywordflow">if</span> (snmp_handle-&gt;oid_encoded[aux-1] == 1 &amp;&amp;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            snmp_handle-&gt;oid_encoded[aux-2] == 2 &amp;&amp;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            snmp_handle-&gt;oid_encoded[aux-3] == 1 &amp;&amp;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            snmp_handle-&gt;oid_encoded[aux-4] == 6 &amp;&amp;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            snmp_handle-&gt;oid_encoded[aux-5] == 0x2b) {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;          snmp_handle-&gt;oid_encoded[1] += 2;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;          snmp_handle-&gt;oid_encoded[aux+1] = 1;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;          snmp_handle-&gt;oid_encoded[aux+2] = 0;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;          snmp_handle-&gt;oid_encoded[aux+3] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        }</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="comment">// We need to set to the nearest OID for the snmpwalk... requisition, in this case .1.0</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        status_mib2 = <a class="code" href="mibii_8c.html#aa0bb802c0b80aaab6218e5a7753f8e28">mib_ii_get_oid</a>(snmp_handle-&gt;oid_encoded,&amp;string_value[0]);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      }</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="preprocessor">      #ifdef DEBUG_SNMP_DECODING</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      debug_snmp(<span class="stringliteral">&quot;GET NEXT Request PDU Type&quot;</span>);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="preprocessor">      #endif</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      <span class="keywordflow">if</span> (!status_mib2){</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="preprocessor">        #ifdef DEBUG_SNMP_DECODING</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        debug_snmp(<span class="stringliteral">&quot;There isn&#39;t an value for that OID!&quot;</span>);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="preprocessor">        #endif</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        snmp_handle-&gt;value[0] = 0x05;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        snmp_handle-&gt;value[1] = 0x00;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      }</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        aux = strlen((<span class="keyword">const</span> <span class="keywordtype">char</span>*)string_value);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        snmp_handle-&gt;value[0] = ASN1_PRIM_OCT_STR;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        snmp_handle-&gt;value[1] = aux;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; aux; i++)</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;          snmp_handle-&gt;value[2+i] = string_value[i];</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        #ifdef DEBUG_SNMP_DECODING</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        debug_snmp(<span class="stringliteral">&quot;String for OID: &quot;</span>);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="keywordflow">for</span> (i=0; i &lt; aux+2; i++){</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;          <span class="keywordflow">if</span> (i == 0)</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            printf(<span class="stringliteral">&quot;[%x]&quot;</span>,snmp_handle-&gt;value[i]);</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == 1)</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            printf(<span class="stringliteral">&quot;[%d][&quot;</span>,snmp_handle-&gt;value[i]);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            printf(<span class="stringliteral">&quot;%c&quot;</span>,snmp_handle-&gt;value[i]);</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        }</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        printf(<span class="stringliteral">&quot;]&quot;</span>);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="preprocessor">        #endif</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      }</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keywordflow">case</span> ASN1_CPX_GET_RESP:</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordflow">case</span> ASN1_CPX_SET_REQ:</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="preprocessor">      #ifdef DEBUG_SNMP_DECODING</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      debug_snmp(<span class="stringliteral">&quot;The PDU type is not know&quot;</span>);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="preprocessor">      #endif</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="snmp_8h.html#add91ba4199db8665b9b9fc56fc6783a6ac6ae922662cbaf7958eb387bfd6fe4da">FAIL_CON</a>;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  }</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="preprocessor">  #ifdef DEBUG_SNMP_DECODING</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="snmp_8h.html#add91ba4199db8665b9b9fc56fc6783a6ae7b7a388c90c2c5428cced225760885f">SUCCESS_CON</a>;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;}</div>
<div class="ttc" id="mibii_8c_html_aa0bb802c0b80aaab6218e5a7753f8e28"><div class="ttname"><a href="mibii_8c.html#aa0bb802c0b80aaab6218e5a7753f8e28">mib_ii_get_oid</a></div><div class="ttdeci">resp_con_t mib_ii_get_oid(uint8_t *oid, uint8_t *oid_string)</div><div class="ttdoc">Get OID Value in the MIB tree. </div><div class="ttdef"><b>Definition:</b> mibii.c:65</div></div>
<div class="ttc" id="snmp_8h_html_a23bdc4d15d908a80e4bc06be55463ffc"><div class="ttname"><a href="snmp_8h.html#a23bdc4d15d908a80e4bc06be55463ffc">MAX_OCTET_STRING</a></div><div class="ttdeci">#define MAX_OCTET_STRING</div><div class="ttdoc">Max data types in each kind of variable. </div><div class="ttdef"><b>Definition:</b> snmp.h:70</div></div>
<div class="ttc" id="snmp__asn1_8c_html_acb3a9652e9b960748692caef7f443384"><div class="ttname"><a href="snmp__asn1_8c.html#acb3a9652e9b960748692caef7f443384">decode_asn1_integer</a></div><div class="ttdeci">resp_con_t decode_asn1_integer(uint8_t *data_encoded, uint32_t *integer_value)</div><div class="ttdoc">SNMP Decode Integer. </div><div class="ttdef"><b>Definition:</b> snmp_asn1.c:91</div></div>
<div class="ttc" id="snmp_8h_html_a1f1b7fadcf29f1de5bb406bf356c1d71"><div class="ttname"><a href="snmp_8h.html#a1f1b7fadcf29f1de5bb406bf356c1d71">SNMP_VERSION_1</a></div><div class="ttdeci">#define SNMP_VERSION_1</div><div class="ttdoc">value of the version field for the SNMPv1 </div><div class="ttdef"><b>Definition:</b> snmp.h:99</div></div>
<div class="ttc" id="snmp_8h_html_add91ba4199db8665b9b9fc56fc6783a6ac6ae922662cbaf7958eb387bfd6fe4da"><div class="ttname"><a href="snmp_8h.html#add91ba4199db8665b9b9fc56fc6783a6ac6ae922662cbaf7958eb387bfd6fe4da">FAIL_CON</a></div><div class="ttdoc">Error to to process function. </div><div class="ttdef"><b>Definition:</b> snmp.h:143</div></div>
<div class="ttc" id="snmp_8h_html_aa4d923102cb2314e31cbf833482e9090"><div class="ttname"><a href="snmp_8h.html#aa4d923102cb2314e31cbf833482e9090">ASN1_CPX_SEQUENCE</a></div><div class="ttdeci">#define ASN1_CPX_SEQUENCE</div><div class="ttdoc">Complex data types of ANS.1 encoding. </div><div class="ttdef"><b>Definition:</b> snmp.h:77</div></div>
<div class="ttc" id="snmp_8h_html_a388ebedb8b344492bded4ba233fab27d"><div class="ttname"><a href="snmp_8h.html#a388ebedb8b344492bded4ba233fab27d">check_seq</a></div><div class="ttdeci">#define check_seq(x)</div><div class="ttdoc">Decode the initial sequence type. </div><div class="ttdef"><b>Definition:</b> snmp.h:105</div></div>
<div class="ttc" id="snmp_8h_html_add91ba4199db8665b9b9fc56fc6783a6ae7b7a388c90c2c5428cced225760885f"><div class="ttname"><a href="snmp_8h.html#add91ba4199db8665b9b9fc56fc6783a6ae7b7a388c90c2c5428cced225760885f">SUCCESS_CON</a></div><div class="ttdoc">Sucess to process function. </div><div class="ttdef"><b>Definition:</b> snmp.h:144</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a63d8ffecf9aa0af9824de046643c140f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t snmp_encode_message </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsnmp__t.html">snmp_t</a> *&#160;</td>
          <td class="paramname"><em>snmp_handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>data_encoded</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Encode SNMP message. </p>
<p>Encode a SNMP message and format to send the answer.</p>
<dl class="params"><dt>Parâmetros</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">snmp_handle</td><td>Struct that will be encoded in the SNMP message format </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">data_encoded</td><td>Variable that'll receive the encoded SNMP Message</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Valores retornados</dt><dd>
  <table class="retval">
    <tr><td class="paramname">length</td><td>Length of UDP packet encoded </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                                                                     {</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  uint8_t i, aux = 0, aux2 = 0;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  *data_encoded = <a class="code" href="snmp_8h.html#aa4d923102cb2314e31cbf833482e9090">ASN1_CPX_SEQUENCE</a>;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  aux2 = 0;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  aux2 += 3+(snmp_handle-&gt;community[1]+2)+12;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  aux2 += (snmp_handle-&gt;request_id_c[1]+2);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  aux2 += (snmp_handle-&gt;oid_encoded[1]+2);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  aux2 += (snmp_handle-&gt;value[1]+2);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  *(data_encoded+1) = aux2;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  *(data_encoded+2) = <a class="code" href="snmp_8h.html#a45fec4a033960bca8c60e2f40d1d0e04">ASN1_PRIM_INTEGER</a>;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  *(data_encoded+3) = 0x01;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="keywordflow">switch</span> (snmp_handle-&gt;snmp_version) {</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="snmp_8h.html#a1f1b7fadcf29f1de5bb406bf356c1d71">SNMP_VERSION_1</a>:</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      *(data_encoded+4) = <a class="code" href="snmp_8h.html#a1f1b7fadcf29f1de5bb406bf356c1d71">SNMP_VERSION_1</a>;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="snmp_8h.html#a0599530b4b198b2c7fa49a274f3f3878">SNMP_VERSION_2C</a>:</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      *(data_encoded+4) = <a class="code" href="snmp_8h.html#a0599530b4b198b2c7fa49a274f3f3878">SNMP_VERSION_2C</a>;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="snmp_8h.html#aa0b283beac3c7da5c28058f52a817c0c">SNMP_VERSION_3</a>:</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      *(data_encoded+4) = <a class="code" href="snmp_8h.html#aa0b283beac3c7da5c28058f52a817c0c">SNMP_VERSION_3</a>;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      debug_snmp(<span class="stringliteral">&quot;Version SNMP not supported&quot;</span>);</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="snmp_8h.html#add91ba4199db8665b9b9fc56fc6783a6ac6ae922662cbaf7958eb387bfd6fe4da">FAIL_CON</a>;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  }</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="keywordflow">for</span> ( i = 0; i &lt; snmp_handle-&gt;community[1]+2; i++)</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    *(data_encoded+5+i) = snmp_handle-&gt;community[i];</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  aux = 5+snmp_handle-&gt;community[1]+2;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  *(data_encoded+aux) = ASN1_CPX_GET_RESP;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  aux2 = 0;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  aux2 += (snmp_handle-&gt;request_id_c[1]+2)+10;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  aux2 += (snmp_handle-&gt;oid_encoded[1]+2);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  aux2 += (snmp_handle-&gt;value[1]+2);</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  *(data_encoded+aux+1) = aux2;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  aux += 2;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="keywordflow">for</span> ( i = 0; i &lt; snmp_handle-&gt;request_id_c[1]+2; i++)</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    *(data_encoded+aux+i) = snmp_handle-&gt;request_id_c[i];</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  aux += snmp_handle-&gt;request_id_c[1]+2;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="keywordflow">if</span> (snmp_handle-&gt;value[0] == ASN1_PRIM_NULL) {</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    *(data_encoded+aux) = <a class="code" href="snmp_8h.html#a45fec4a033960bca8c60e2f40d1d0e04">ASN1_PRIM_INTEGER</a>;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    aux++;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    *(data_encoded+aux) = 0x01;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    aux++;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    *(data_encoded+aux) = ERROR_REQ_OID_NOT_FOUND;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    aux++;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    *(data_encoded+aux) = <a class="code" href="snmp_8h.html#a45fec4a033960bca8c60e2f40d1d0e04">ASN1_PRIM_INTEGER</a>;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    aux++;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    *(data_encoded+aux) = 0x01;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    aux++;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    *(data_encoded+aux) = ERROR_RESP_TOO_LARGE;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    aux++;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    *(data_encoded+aux) = <a class="code" href="snmp_8h.html#aa4d923102cb2314e31cbf833482e9090">ASN1_CPX_SEQUENCE</a>;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    aux++;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    aux2 = 2;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    aux2 += (snmp_handle-&gt;oid_encoded[1]+2);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    aux2 += (snmp_handle-&gt;value[1]+2);</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    *(data_encoded+aux) = aux2;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    aux++;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    *(data_encoded+aux) = <a class="code" href="snmp_8h.html#aa4d923102cb2314e31cbf833482e9090">ASN1_CPX_SEQUENCE</a>;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    aux++;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    aux2 = 0;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    aux2 += (snmp_handle-&gt;oid_encoded[1]+2);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    aux2 += (snmp_handle-&gt;value[1]+2);</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    *(data_encoded+aux) = aux2;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    aux++;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="keywordflow">for</span> ( i = 0; i &lt; snmp_handle-&gt;oid_encoded[1]+2; i++)</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      *(data_encoded+aux+i) = snmp_handle-&gt;oid_encoded[i];</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    aux += snmp_handle-&gt;oid_encoded[1]+2;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    *(data_encoded+aux) = ASN1_PRIM_NULL;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    aux++;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    *(data_encoded+aux) = 0x00;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  }</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    *(data_encoded+aux) = <a class="code" href="snmp_8h.html#a45fec4a033960bca8c60e2f40d1d0e04">ASN1_PRIM_INTEGER</a>;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    aux++;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    *(data_encoded+aux) = 0x01;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    aux++;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    *(data_encoded+aux) = <a class="code" href="snmp_8h.html#abe670cc5ceed3fad3be682fc0c1bb62e">ERROR_NONE</a>;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    aux++;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    *(data_encoded+aux) = <a class="code" href="snmp_8h.html#a45fec4a033960bca8c60e2f40d1d0e04">ASN1_PRIM_INTEGER</a>;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    aux++;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    *(data_encoded+aux) = 0x01;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    aux++;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    *(data_encoded+aux) = <a class="code" href="snmp_8h.html#abe670cc5ceed3fad3be682fc0c1bb62e">ERROR_NONE</a>;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    aux++;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    *(data_encoded+aux) = <a class="code" href="snmp_8h.html#aa4d923102cb2314e31cbf833482e9090">ASN1_CPX_SEQUENCE</a>;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    aux++;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    aux2 = 2;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    aux2 += (snmp_handle-&gt;oid_encoded[1]+2);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    aux2 += (snmp_handle-&gt;value[1]+2);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    *(data_encoded+aux) = aux2;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    aux++;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    *(data_encoded+aux) = <a class="code" href="snmp_8h.html#aa4d923102cb2314e31cbf833482e9090">ASN1_CPX_SEQUENCE</a>;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    aux++;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    aux2 = 0;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    aux2 += (snmp_handle-&gt;oid_encoded[1]+2);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    aux2 += (snmp_handle-&gt;value[1]+2);</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    *(data_encoded+aux) = aux2;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    aux++;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordflow">for</span> ( i = 0; i &lt; snmp_handle-&gt;oid_encoded[1]+2; i++)</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      *(data_encoded+aux+i) = snmp_handle-&gt;oid_encoded[i];</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    aux += snmp_handle-&gt;oid_encoded[1]+2;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordflow">for</span> ( i = 0; i &lt; snmp_handle-&gt;value[1]+2; i++)</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      *(data_encoded+aux+i) = snmp_handle-&gt;value[i];</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  }</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="preprocessor">  #ifdef DEBUG_SNMP_DECODING</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  debug_snmp(<span class="stringliteral">&quot;Len of encoded packet: %d&quot;</span>,*(data_encoded+1)+1);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <span class="keywordflow">return</span> *(data_encoded+1)+2;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;}</div>
<div class="ttc" id="snmp_8h_html_aa0b283beac3c7da5c28058f52a817c0c"><div class="ttname"><a href="snmp_8h.html#aa0b283beac3c7da5c28058f52a817c0c">SNMP_VERSION_3</a></div><div class="ttdeci">#define SNMP_VERSION_3</div><div class="ttdoc">value of the version field for the SNMPv3 </div><div class="ttdef"><b>Definition:</b> snmp.h:103</div></div>
<div class="ttc" id="snmp_8h_html_a0599530b4b198b2c7fa49a274f3f3878"><div class="ttname"><a href="snmp_8h.html#a0599530b4b198b2c7fa49a274f3f3878">SNMP_VERSION_2C</a></div><div class="ttdeci">#define SNMP_VERSION_2C</div><div class="ttdoc">value of the version field for the SNMPv2c </div><div class="ttdef"><b>Definition:</b> snmp.h:101</div></div>
<div class="ttc" id="snmp_8h_html_a45fec4a033960bca8c60e2f40d1d0e04"><div class="ttname"><a href="snmp_8h.html#a45fec4a033960bca8c60e2f40d1d0e04">ASN1_PRIM_INTEGER</a></div><div class="ttdeci">#define ASN1_PRIM_INTEGER</div><div class="ttdoc">Primitives data types of ANS.1 encoding. </div><div class="ttdef"><b>Definition:</b> snmp.h:59</div></div>
<div class="ttc" id="snmp_8h_html_a1f1b7fadcf29f1de5bb406bf356c1d71"><div class="ttname"><a href="snmp_8h.html#a1f1b7fadcf29f1de5bb406bf356c1d71">SNMP_VERSION_1</a></div><div class="ttdeci">#define SNMP_VERSION_1</div><div class="ttdoc">value of the version field for the SNMPv1 </div><div class="ttdef"><b>Definition:</b> snmp.h:99</div></div>
<div class="ttc" id="snmp_8h_html_add91ba4199db8665b9b9fc56fc6783a6ac6ae922662cbaf7958eb387bfd6fe4da"><div class="ttname"><a href="snmp_8h.html#add91ba4199db8665b9b9fc56fc6783a6ac6ae922662cbaf7958eb387bfd6fe4da">FAIL_CON</a></div><div class="ttdoc">Error to to process function. </div><div class="ttdef"><b>Definition:</b> snmp.h:143</div></div>
<div class="ttc" id="snmp_8h_html_aa4d923102cb2314e31cbf833482e9090"><div class="ttname"><a href="snmp_8h.html#aa4d923102cb2314e31cbf833482e9090">ASN1_CPX_SEQUENCE</a></div><div class="ttdeci">#define ASN1_CPX_SEQUENCE</div><div class="ttdoc">Complex data types of ANS.1 encoding. </div><div class="ttdef"><b>Definition:</b> snmp.h:77</div></div>
<div class="ttc" id="snmp_8h_html_abe670cc5ceed3fad3be682fc0c1bb62e"><div class="ttname"><a href="snmp_8h.html#abe670cc5ceed3fad3be682fc0c1bb62e">ERROR_NONE</a></div><div class="ttdeci">#define ERROR_NONE</div><div class="ttdoc">Types of errors in SNMP PDU. </div><div class="ttdef"><b>Definition:</b> snmp.h:49</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af72c0873252d8160ff31eae19d05a5a1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t snmp_encode_trap </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>trap_pdu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>type_trap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>heartbeat</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Encode a SNMPv1 Trap message. </p>
<p>Encode a SNMPv1 Trap type message with AWGES PEN and heartbeat value</p>
<dl class="params"><dt>Parâmetros</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">trap_pdu</td><td>Variable that'll receive the packet encoded </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">type_trap</td><td>Type of trap that'll send ("coldStart","WarmStart"...) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">heartbeat</td><td>Heartbeat value of the node</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Valores retornados</dt><dd>
  <table class="retval">
    <tr><td class="paramname">len</td><td>Length of encoded packet </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                                                                                  {</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="comment">// uint8_t i;//, aux = 0, aux2 = 0;</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  uint16_t length_trap = 0, aux = 0;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  *trap_pdu = <a class="code" href="snmp_8h.html#aa4d923102cb2314e31cbf833482e9090">ASN1_CPX_SEQUENCE</a>;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  *(trap_pdu+1) = 52+4;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  <span class="comment">// SNMP Version</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  *(trap_pdu+2) = <a class="code" href="snmp_8h.html#a45fec4a033960bca8c60e2f40d1d0e04">ASN1_PRIM_INTEGER</a>;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  *(trap_pdu+3) = 0x01;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  *(trap_pdu+4) = <a class="code" href="snmp_8h.html#a1f1b7fadcf29f1de5bb406bf356c1d71">SNMP_VERSION_1</a>;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <span class="comment">// Comunity String - always &quot;public&quot;</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  *(trap_pdu+5) = ASN1_PRIM_OCT_STR;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  *(trap_pdu+6) = 0x06;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  *(trap_pdu+7) = 0x70;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  *(trap_pdu+8) = 0x75;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  *(trap_pdu+9) = 0x62;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  *(trap_pdu+10) = 0x6c;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  *(trap_pdu+11) = 0x69;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  *(trap_pdu+12) = 0x63;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  <span class="comment">// Type of PDU - Trap(0xa4)</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  *(trap_pdu+13) = ASN1_CPX_TRAP;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  aux = 14;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  *(trap_pdu+aux) = 39+4;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <span class="comment">// Enterprise OID - 0x06, 0x09, 0x2b, 0x06, 0x01, 0x04, 0x01, 0x04, 0x01, 0x02, 0x15</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  aux++;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  *(trap_pdu+aux) = ASN1_PRIM_OID;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  aux++;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  *(trap_pdu+aux) = 0x09;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  aux++;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  *(trap_pdu+aux) = 0x2b;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  aux++;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  *(trap_pdu+aux) = 0x06;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  aux++;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  *(trap_pdu+aux) = 0x01;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  aux++;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  *(trap_pdu+aux) = 0x04;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  aux++;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  *(trap_pdu+aux) = 0x01;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  aux++;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  *(trap_pdu+aux) = 0x04;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  aux++;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  *(trap_pdu+aux) = 0x01;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  aux++;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  *(trap_pdu+aux) = 0x02;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  aux++;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  *(trap_pdu+aux) = 0x15;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <span class="comment">// IP Address of the agent, always 0.0.0.0 if we cannot send IPv6 in SNMPv1, in SNMPv2 the trap calls inform</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  aux++;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  *(trap_pdu+aux) = ASN1_PRIM_IP_ADDRESS;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  aux++;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  *(trap_pdu+aux) = 4;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  aux++;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  *(trap_pdu+aux) = 0;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  aux++;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  *(trap_pdu+aux) = 0;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  aux++;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  *(trap_pdu+aux) = 0;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  aux++;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  *(trap_pdu+aux) = 0;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  <span class="comment">// Generic Trap type</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  aux++;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  *(trap_pdu+aux) = <a class="code" href="snmp_8h.html#a45fec4a033960bca8c60e2f40d1d0e04">ASN1_PRIM_INTEGER</a>;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  aux++;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  *(trap_pdu+aux) = 0x01;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  aux++;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  *(trap_pdu+aux) = type_trap;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  <span class="comment">// Specific Trap Number - we don&#39;t use this</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  aux++;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  *(trap_pdu+aux) = <a class="code" href="snmp_8h.html#a45fec4a033960bca8c60e2f40d1d0e04">ASN1_PRIM_INTEGER</a>;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  aux++;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  *(trap_pdu+aux) = 0x01;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  aux++;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  *(trap_pdu+aux) = 0x00;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <span class="comment">// Timestamp - we don&#39;t use this - default(0)</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  aux++;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  *(trap_pdu+aux) = ASN1_PRIM_TIMESTAMP;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  aux++;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  *(trap_pdu+aux) = 0x01;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  aux++;</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  *(trap_pdu+aux) = 0x00;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  <span class="comment">// VarBind List - we don&#39;t use this - default(0)</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  aux++;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  *(trap_pdu+aux) = <a class="code" href="snmp_8h.html#aa4d923102cb2314e31cbf833482e9090">ASN1_CPX_SEQUENCE</a>;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  aux++;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  *(trap_pdu+aux) = 3+8+2+2;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <span class="comment">// VarBind List - we don&#39;t use this - default(0)</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  aux++;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  *(trap_pdu+aux) = <a class="code" href="snmp_8h.html#aa4d923102cb2314e31cbf833482e9090">ASN1_CPX_SEQUENCE</a>;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  aux++;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  *(trap_pdu+aux) = 3+8+2;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  <span class="comment">// OID</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  aux++;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  *(trap_pdu+aux) = ASN1_PRIM_OID;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  aux++;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  *(trap_pdu+aux) = 0x08;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  aux++;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  *(trap_pdu+aux) = 0x2b;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  aux++;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  *(trap_pdu+aux) = 0x06;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  aux++;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  *(trap_pdu+aux) = 0x01;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  aux++;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  *(trap_pdu+aux) = 0x02;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  aux++;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  *(trap_pdu+aux) = 0x01;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  aux++;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  *(trap_pdu+aux) = 0x02;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  aux++;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  *(trap_pdu+aux) = 0x01;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  aux++;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  *(trap_pdu+aux) = 0x00;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  <span class="comment">// Value - Heartbeat</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  aux++;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  *(trap_pdu+aux) = <a class="code" href="snmp_8h.html#a45fec4a033960bca8c60e2f40d1d0e04">ASN1_PRIM_INTEGER</a>;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  aux++;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  *(trap_pdu+aux) = 0x01;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  aux++;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  *(trap_pdu+aux) = heartbeat;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  length_trap = 54+4;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  <span class="keywordflow">return</span> length_trap;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;}</div>
<div class="ttc" id="snmp_8h_html_a45fec4a033960bca8c60e2f40d1d0e04"><div class="ttname"><a href="snmp_8h.html#a45fec4a033960bca8c60e2f40d1d0e04">ASN1_PRIM_INTEGER</a></div><div class="ttdeci">#define ASN1_PRIM_INTEGER</div><div class="ttdoc">Primitives data types of ANS.1 encoding. </div><div class="ttdef"><b>Definition:</b> snmp.h:59</div></div>
<div class="ttc" id="snmp_8h_html_a1f1b7fadcf29f1de5bb406bf356c1d71"><div class="ttname"><a href="snmp_8h.html#a1f1b7fadcf29f1de5bb406bf356c1d71">SNMP_VERSION_1</a></div><div class="ttdeci">#define SNMP_VERSION_1</div><div class="ttdoc">value of the version field for the SNMPv1 </div><div class="ttdef"><b>Definition:</b> snmp.h:99</div></div>
<div class="ttc" id="snmp_8h_html_aa4d923102cb2314e31cbf833482e9090"><div class="ttname"><a href="snmp_8h.html#aa4d923102cb2314e31cbf833482e9090">ASN1_CPX_SEQUENCE</a></div><div class="ttdeci">#define ASN1_CPX_SEQUENCE</div><div class="ttdoc">Complex data types of ANS.1 encoding. </div><div class="ttdef"><b>Definition:</b> snmp.h:77</div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Gerado em Quinta, 29 de Setembro de 2016 00:56:28 para HomeStark_6LoWPAN_Device por &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
